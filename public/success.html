<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Success â€” iseehalo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>
<body>
  <h1>Payment Success ðŸŽ‰</h1>
  <p>Thanks! Weâ€™re activating your premium.</p>
  <p id="status">Checking status...</p>

  <script>
    const params = new URLSearchParams(location.search);
    const session_id = params.get("session_id");
    const email = params.get("email");

    async function confirmNow() {
      if (!session_id || !email) return;

      try {
        const r = await fetch("/confirm-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ session_id, email }),
        });
        const data = await r.json();
        console.log("confirm-session:", data);

        const el = document.getElementById("status");
        if (data.ok && data.premium) {
          if (el) el.textContent = "Premium is active. Enjoy!";
        } else {
          if (el) el.textContent = "Still verifyingâ€¦ try refresh in a few seconds.";
        }
      } catch (err) {
        console.error(err);
      }
    }

    // run immediately after landing on success page
    confirmNow();
  </script>

  <p><a href="/">Back to home</a></p>
</body>
</html>
